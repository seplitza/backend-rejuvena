# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–º–ø–æ—Ä—Ç—É –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å—Ç–∞—Ä–æ–π CRM

## –û–±–∑–æ—Ä

–í –ø—Ä–æ–µ–∫—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å—Ç–∞—Ä–æ–π CRM —Å–∏—Å—Ç–µ–º—ã:

### 1. –ò–º–ø–æ—Ä—Ç –∑–∞–∫–∞–∑–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤ (–º–∞–≥–∞–∑–∏–Ω)
**–§–∞–π–ª:** `src/scripts/import-crm-orders.ts`  
**–ß—Ç–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç:** –ó–∞–∫–∞–∑—ã —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π CDEK

```bash
npx ts-node src/scripts/import-crm-orders.ts
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°–æ–∑–¥–∞—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `orders`
- –ù–æ–º–µ—Ä–∞ –∑–∞–∫–∞–∑–æ–≤ –∏–º–µ—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `CRM-`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ, —Ç—Ä–µ–∫–∏–Ω–≥ CDEK, —Å—Ç–∞—Ç—É—Å—ã

### 2. –ò–º–ø–æ—Ä—Ç –ø–æ–∫—É–ø–æ–∫ –∫—É—Ä—Å–æ–≤
**–§–∞–π–ª:** `src/scripts/import-course-payments.ts`  
**–ß—Ç–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç:** –ü–æ–∫—É–ø–∫–∏ –æ–Ω–ª–∞–π–Ω –∫—É—Ä—Å–æ–≤, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π, –º–∞—Ä–∞—Ñ–æ–Ω–æ–≤

```bash
npx ts-node src/scripts/import-course-payments.ts
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°–æ–∑–¥–∞—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `payments`
- –ù–æ–º–µ—Ä–∞ –ø–ª–∞—Ç–µ–∂–µ–π –∏–º–µ—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `CRM-COURSE-`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –æ—Ç –∑–∞–∫–∞–∑–æ–≤ —Å —Ç–æ–≤–∞—Ä–∞–º–∏
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫—É—Ä—Å–µ –≤ metadata

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ç–ª–∏—á–∏—è –∫—É—Ä—Å–∞ –æ—Ç —Ç–æ–≤–∞—Ä–∞:**
- –ù–µ—Ç CDEK —Ç—Ä–µ–∫–∏–Ω–≥–∞
- –ù–µ—Ç –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏ –≤ –∞–¥—Ä–µ—Å–µ –¥–æ—Å—Ç–∞–≤–∫–∏
- –ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: –∫—É—Ä—Å, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è, –º–∞—Ä–∞—Ñ–æ–Ω, —Ç—Ä–µ–Ω–∏–Ω–≥ –∏ —Ç.–¥.

### 3. –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤ –º–∞–≥–∞–∑–∏–Ω–∞
**–§–∞–π–ª:** `src/scripts/import-shop-data.ts`  
**–ß—Ç–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç:** –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∑–∞–∫–∞–∑—ã

```bash
npx ts-node src/scripts/import-shop-data.ts
```

## –§–æ—Ä–º–∞—Ç CSV —Ñ–∞–π–ª–æ–≤

–°–∫—Ä–∏–ø—Ç—ã –æ–∂–∏–¥–∞—é—Ç CSV —Ñ–∞–π–ª—ã —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º `;` (—Ç–æ—á–∫–∞ —Å –∑–∞–ø—è—Ç–æ–π).

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã:
- `–ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –∑–∞—è–≤–∫–∏` - –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞/–ø–ª–∞—Ç–µ–∂–∞
- `Email` –∏–ª–∏ `–µ–º–µ–π–ª_–∏–∑_—Ñ–æ—Ä–º—ã_–Ω–∞_—Å–∞–π—Ç–µ` - email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞` - —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞
- `–¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞/–∫—É—Ä—Å–∞
- `Date` - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `–°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã` - —Å—Ç–∞—Ç—É—Å (–æ–ø–ª–∞—á–µ–Ω–æ/–Ω–µ –æ–ø–ª–∞—á–µ–Ω–æ)
- `Phone` - —Ç–µ–ª–µ—Ñ–æ–Ω
- `—Ñ–∏–æ` - –§–ò–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã:
- `–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏` - –∞–¥—Ä–µ—Å (–¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤)
- `–¢—Ä–µ–∫ –Ω–æ–º–µ—Ä` - CDEK —Ç—Ä–µ–∫–∏–Ω–≥
- `–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã` - yamoney/card/sbp
- `–î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã` - –¥–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã
- `–ü—Ä–æ–º–æ–∫–æ–¥` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥
- `–°–∫–∏–¥–∫–∞` - —Ä–∞–∑–º–µ—Ä —Å–∫–∏–¥–∫–∏

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏—á–Ω–æ–π —Å–∫–∏–¥–∫–æ–π

### –í User –º–æ–¥–µ–ª–∏:
```typescript
personalDiscount: number // 0-100%
personalDiscountExpiry: Date // —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
```

### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Å–∫–∏–¥–∫–∏:
1. **–ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ `fortuneWheelGifts`
2. **–ü—Ä–æ–º–æ–∫–æ–¥** - –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
3. **–í—Ä—É—á–Ω—É—é –∏–∑ –∞–¥–º–∏–Ω–∫–∏** - —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### API Endpoint:
```
PUT /api/admin/users/:id/discount
Body: {
  personalDiscount: number | null,
  personalDiscountExpiry: string | null
}
```

### –í –∞–¥–º–∏–Ω–∫–µ:
1. –û—Ç–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –ù–∞–π—Ç–∏ –∫–∞—Ä—Ç–æ—á–∫—É "–õ–∏—á–Ω–∞—è —Å–∫–∏–¥–∫–∞ üéÅ"
4. –ù–∞–∂–∞—Ç—å "–ò–∑–º–µ–Ω–∏—Ç—å"
5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç –∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
6. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

–°–∫–∏–¥–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –≤ –º–∞–≥–∞–∑–∏–Ω–µ.

## –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –í –∞–¥–º–∏–Ω–∫–µ (/admin):
1. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ "–ó–∞–∫–∞–∑—ã —à–æ–ø–∞"** - –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã –ø–æ–º–µ—á–µ–Ω—ã –±–µ–π–¥–∂–µ–º "üì¶ –ò–∑ —Å—Ç–∞—Ä–æ–π CRM"
2. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"** ‚Üí –¥–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –≤–∫–ª–∞–¥–∫–∏:
   - **–ó–∞–∫–∞–∑—ã —à–æ–ø–∞** - –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤
   - **–ü–æ–∫—É–ø–∫–∏ –∫—É—Ä—Å–æ–≤** - –∏—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π –∑–∞ –∫—É—Ä—Å—ã
   - **–ò—Å—Ç–æ—Ä–∏—è** - –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:
- –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã: –ø—Ä–µ—Ñ–∏–∫—Å `CRM-` –≤ –Ω–æ–º–µ—Ä–µ
- –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏: –ø—Ä–µ—Ñ–∏–∫—Å `CRM-COURSE-` –≤ –Ω–æ–º–µ—Ä–µ
- –í –∑–∞–º–µ—Ç–∫–∞—Ö –∑–∞–∫–∞–∑–∞: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–º, —á—Ç–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ —Å—Ç–∞—Ä–æ–π CRM
- –°—Ç–∞—Ç—É—Å—ã, –¥–∞—Ç—ã –∏ —Å—É–º–º—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ MongoDB
mongosh mongodb://localhost:27017/rejuvena

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã
db.orders.find({ orderNumber: /^CRM-/ }).count()

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
db.payments.find({ orderNumber: /^CRM-COURSE-/ }).count()

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
db.users.find({ role: 'customer' }).count()
```

## –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∏–º–ø–æ—Ä—Ç

–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º:
- –ï—Å–ª–∏ –∑–∞–∫–∞–∑/–ø–ª–∞—Ç–µ–∂ —Å —Ç–∞–∫–∏–º –Ω–æ–º–µ—Ä–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
- –ú–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –ø–æ–≤—Ç–æ—Ä–Ω–æ

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "–ü—Ä–æ–ø—É—Å–∫ —Å—Ç—Ä–æ–∫–∏: –Ω–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç CSV (—Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `;`)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Ç–æ–ª–±—Ü—ã Email –∏ –°—É–º–º–∞ –∑–∞–∫–∞–∑–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥–∏—Ä–æ–≤–∫—É —Ñ–∞–π–ª–∞ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å UTF-8)

### –û—à–∏–±–∫–∞: "User validation failed: role"
- –û–±–Ω–æ–≤–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `role: 'customer'` –≤–º–µ—Å—Ç–æ `role: 'user'`

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MongoDB
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ MongoDB: `brew services start mongodb-community`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç: `lsof -i :27017`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `MONGO_URI`

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–º–ø–æ—Ä—Ç–∞

### –ó–∞–∫–∞–∑—ã —Ç–æ–≤–∞—Ä–æ–≤ (import-crm-orders.ts):
- ‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: 10 –∑–∞–∫–∞–∑–æ–≤
- üë§ –°–æ–∑–¥–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 9
- üì¶ –ü—Ä–µ—Ñ–∏–∫—Å: CRM-

### –ü–æ–∫—É–ø–∫–∏ –∫—É—Ä—Å–æ–≤ (import-course-payments.ts):
- ‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: 4 –ø–ª–∞—Ç–µ–∂–∞
- üìö –¢–∏–ø—ã: –∫—É—Ä—Å—ã, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
- üì¶ –ü—Ä–µ—Ñ–∏–∫—Å: CRM-COURSE-

---

**–í–∞–∂–Ω–æ:** –í—Å–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏ –æ–ø–ª–∞—Ç—ã –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.
