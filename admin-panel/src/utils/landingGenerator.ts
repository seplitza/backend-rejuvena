// –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –ª–µ–Ω–¥–∏–Ω–≥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø–∏—Å–∞–Ω–∏—è –º–∞—Ä–∞—Ñ–æ–Ω–∞
// –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ —Å–æ–∑–¥–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö –ª–µ–Ω–¥–∏–Ω–≥–æ–≤

interface MarathonData {
  title: string;
  description?: string;
  courseDescription?: string;
  welcomeMessage?: string;
  numberOfDays: number;
  cost: number;
  startDate?: Date;
}

export const generateLandingContent = (marathonData: MarathonData) => {
  const { title, welcomeMessage, numberOfDays, cost } = marathonData;
  
  // –ü—Ä–∞–≤–∏–ª–æ 1: –û–¥–∏–Ω —Ç–æ–≤–∞—Ä ‚Äî –æ–¥–∏–Ω –ª–µ–Ω–¥–∏–Ω–≥ (—Ñ–æ–∫—É—Å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –º–∞—Ä–∞—Ñ–æ–Ω–µ)
  const cleanTitle = title.replace(/–º–∞—Ä–∞—Ñ–æ–Ω/i, '').trim();
  
  return {
    // Hero Section - –ü—Ä–∞–≤–∏–ª–æ 2: –ü—Ä–æ–¥–∞—é—â–∏–π –ø–µ—Ä–≤—ã–π —ç–∫—Ä–∞–Ω
    heroSection: {
      title: `${cleanTitle} - –ú–∞—Ä–∞—Ñ–æ–Ω –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ–º–æ–ª–æ–∂–µ–Ω–∏—è`,
      subtitle: welcomeMessage || '–ü—Ä–µ–æ–±—Ä–∞–∑–∏—Ç–µ —Å–≤–æ—é –≤–Ω–µ—à–Ω–æ—Å—Ç—å –±–µ–∑ –∏–Ω—ä–µ–∫—Ü–∏–π –∏ –æ–ø–µ—Ä–∞—Ü–∏–π. –†–µ–∑—É–ª—å—Ç–∞—Ç —É–∂–µ —á–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏!',
      ctaButton: {
        text: '–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –º–∞—Ä–∞—Ñ–æ–Ω',
        link: '#marathons'
      }
    },
    
    // Meta –¥–ª—è SEO
    metaData: {
      title: `${cleanTitle} | –ú–∞—Ä–∞—Ñ–æ–Ω –°–µ–ø–ª–∏—Ü–∞ - –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–º–æ–ª–æ–∂–µ–Ω–∏–µ`,
      description: `–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –º–∞—Ä–∞—Ñ–æ–Ω—É ${cleanTitle}! ${numberOfDays} –¥–Ω–µ–π –ø—Ä–∞–∫—Ç–∏–∫–∏. –°—Ç–æ–∏–º–æ—Å—Ç—å ${cost}‚ÇΩ. –ë–µ–∑ –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –∏–Ω—ä–µ–∫—Ü–∏–π.`,
    },
    
    // –ü—Ä–∞–≤–∏–ª–æ 3: –û—Ç–≤–µ—á–∞–µ–º –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –∫–ª–∏–µ–Ω—Ç–∞
    benefitsSection: {
      sectionTitle: '–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç —Å–∏—Å—Ç–µ–º—É –°–µ–ø–ª–∏—Ü–∞',
      benefits: [
        {
          icon: 'üí∞',
          title: '–≠–∫–æ–Ω–æ–º–∏—è',
          description: `–û–¥–∏–Ω –∫—É—Ä—Å —É –∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∞ ‚Äî –æ—Ç 100,000‚ÇΩ/–≥–æ–¥. –ú–∞—Ä–∞—Ñ–æ–Ω ‚Äî –≤—Å–µ–≥–æ ${cost}‚ÇΩ –∑–∞ ${numberOfDays} –¥–Ω–µ–π (—ç—Ç–æ ${Math.round(cost / numberOfDays)}‚ÇΩ –≤ –¥–µ–Ω—å!)`
        },
        {
          icon: '‚è∞',
          title: '–£–¥–æ–±—Å—Ç–≤–æ',
          description: '–í—Å–µ–≥–æ 15-20 –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å, –∑–∞–Ω–∏–º–∞–π—Ç–µ—Å—å –¥–æ–º–∞ –≤ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è'
        },
        {
          icon: 'üå±',
          title: '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å',
          description: '–ù–∏–∫–∞–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, –∏–Ω—ä–µ–∫—Ü–∏–π –∏ —Ä–∏—Å–∫–æ–≤ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π'
        },
        {
          icon: 'üìà',
          title: '–†–µ–∑—É–ª—å—Ç–∞—Ç',
          description: '–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–º–æ–ª–æ–∂–µ–Ω–∏–µ —Å–æ—Ä–∞–∑–º–µ—Ä–Ω–æ –≤–∞—à–∏–º —É—Å–∏–ª–∏—è–º. –ë–æ–ª–µ–µ 50,000 –¥–æ–≤–æ–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤'
        },
        {
          icon: 'üéì',
          title: '–≠–∫—Å–ø–µ—Ä—Ç–Ω–æ—Å—Ç—å',
          description: '–ê–≤—Ç–æ—Ä—Å–∫–∞—è –º–µ—Ç–æ–¥–∏–∫–∞, –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è 15+ –≥–æ–¥–∞–º–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏'
        },
        {
          icon: 'üì±',
          title: '–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏',
          description: '–§–æ—Ç–æ–¥–Ω–µ–≤–Ω–∏–∫ —Å –ò–ò, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–ª–ª–∞–∂–∏ –î–æ/–ü–æ—Å–ª–µ, Agebot –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–æ–∑—Ä–∞—Å—Ç–∞'
        }
      ]
    },
    
    // –ü—Ä–∞–≤–∏–ª–æ 4: –î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω - —Ä–µ–∞–ª—å–Ω—ã–µ –æ—Ç–∑—ã–≤—ã
    testimonialsSection: {
      sectionTitle: '–û—Ç–∑—ã–≤—ã –Ω–∞—à–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤',
      testimonials: [
        {
          name: '–ï–ª–µ–Ω–∞ –°.',
          age: '52 –≥–æ–¥–∞',
          text: '–ß–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏ —è –≤—ã–≥–ª—è–∂—É –∫–∞–∫ —Å 48 –¥–æ 43, –º–Ω–µ 56! –ï—Å–ª–∏ –±—ã —è —É–≤–∏–¥–µ–ª–∞ –≤–∞—Å, —è –±—ã –∑–∞—Ç–∏—Å–∫–∞–ª–∞ –≤–∞—Å –¥–æ —Å–º–µ—Ä—Ç–∏! –ï—â–µ –º–Ω–æ–≥–æ —Ä–∞–±–æ—Ç—ã –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç —Å–¥–µ–ª–∞—Ç—å, –Ω–æ —è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ! –°–ø–∞—Å–∏–±–æ, —Å–ø–∞—Å–∏–±–æ, —Å–ø–∞—Å–∏–±–æ! –Ø —Ç–∞–∫ —Å—á–∞—Å—Ç–ª–∏–≤–∞!',
          rating: 5
        },
        {
          name: '–ú–∞—Ä–∏–Ω–∞ –ö.',
          age: '49 –ª–µ—Ç',
          text: '–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç! –Ø –∑–∞–Ω–∏–º–∞—é—Å—å —É–∂–µ 3 –º–µ—Å—è—Ü–∞ –∏ –≤–∏–∂—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è. –õ–∏—Ü–æ —Å—Ç–∞–ª–æ –±–æ–ª–µ–µ –ø–æ–¥—Ç—è–Ω—É—Ç—ã–º, –æ—Ç–µ–∫–∏ —É—à–ª–∏, –∫–æ–∂–∞ —Å—Ç–∞–ª–∞ –±–æ–ª–µ–µ —É–ø—Ä—É–≥–æ–π. –í—Å–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ –∏ —É–¥–æ–±–Ω–æ –æ–±—ä—è—Å–Ω–µ–Ω—ã. –°–ø–∞—Å–∏–±–æ –∑–∞ —Ç–∞–∫—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É!',
          rating: 5
        },
        {
          name: '–°–µ—Ä–∞—Ñ–∏–º–∞ –ì.',
          age: '–ú–æ–¥–µ–ª—å',
          text: '–Ø —Å—Ç–∞–ª–∞ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–≤–æ–∏ –º—ã—à—Ü—ã –∏ –ø–æ–Ω–∏–º–∞—Ç—å, –≥–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –∑–∞–∂–∏–º—ã. –Ø –ø—Ä–æ—Å—Ç–æ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∞, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –±–æ—Ç–æ–∫—Å –∏ —á—Ç–æ –µ–≥–æ –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –∑–∞–º–µ–Ω–∏—Ç—å —Ä—É–∫–∞–º–∏. –ü—Ä–æ—Å—Ç–æ –ø–æ—Ç—Ä—è—Å–∞—é—â–µ. –í–∏–∂—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—å—à–µ –æ—Ç–µ–∫–æ–≤ –ø–æ —É—Ç—Ä–∞–º.',
          rating: 5
        },
        {
          name: '–û–ª—å–≥–∞ –í.',
          age: '52 –≥–æ–¥–∞',
          text: '–ù–µ –º–æ–≥—É –ø–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —ç—Ç–æ —Ç–∞–∫ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ! –ö–∞—á–µ—Å—Ç–≤–æ –∫—É—Ä—Å–æ–≤ –Ω–∞ –≤—ã—Å—à–µ–º —É—Ä–æ–≤–Ω–µ. –ó–∞—Ä—è–¥–∫–∞ –¥–æ–ª–≥–æ–ª–µ—Ç–∏—è —Å—Ç–∞–ª–∞ –º–æ–∏–º —É—Ç—Ä–µ–Ω–Ω–∏–º —Ä–∏—Ç—É–∞–ª–æ–º. –ß—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –±–æ–¥—Ä–æ–π –∏ —ç–Ω–µ—Ä–≥–∏—á–Ω–æ–π –≤–µ—Å—å –¥–µ–Ω—å. –†–µ–∫–æ–º–µ–Ω–¥—É—é –≤—Å–µ–º!',
          rating: 5
        }
      ]
    },
    
    // CTA Section - –ü—Ä–∞–≤–∏–ª–æ 2: –ß–µ—Ç–∫–∏–π –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é
    ctaSection: {
      title: '–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å —Å–≤–æ—ë –ø—Ä–µ–æ–±—Ä–∞–∂–µ–Ω–∏–µ?',
      subtitle: `–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –º–∞—Ä–∞—Ñ–æ–Ω—É –∏ –ø–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º –Ω–∞ ${numberOfDays} –¥–Ω–µ–π`,
      buttonText: '–ó–∞–ø–∏—Å–∞—Ç—å—Å—è —Å–µ–π—á–∞—Å',
      buttonLink: '/marathons'
    }
  };
};

// –ü–∞—Ä—Å–∏–Ω–≥ courseDescription –∏–∑ Markdown –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
export const parseCourseDescription = (markdown: string) => {
  const lines = markdown.split('\n');
  const features: string[] = [];
  const benefits: string[] = [];
  
  let currentSection = '';
  
  lines.forEach(line => {
    const trimmed = line.trim();
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–µ–∫—Ü–∏–∏
    if (trimmed.includes('–ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ')) {
      currentSection = 'features';
    } else if (trimmed.includes('–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç')) {
      currentSection = 'benefits';
    }
    
    // –°–æ–±–∏—Ä–∞–µ–º –ø—É–Ω–∫—Ç—ã —Å–ø–∏—Å–∫–∞
    if (trimmed.startsWith('‚≠ê') || trimmed.startsWith('‚úÖ')) {
      const text = trimmed.replace(/^[‚≠ê‚úÖ]\s*/, '').replace(/\*\*/g, '');
      if (currentSection === 'features') {
        features.push(text);
      }
    }
    
    if (trimmed.startsWith('üí∞') || trimmed.startsWith('‚è∞') || trimmed.startsWith('üå±')) {
      const parts = trimmed.split('**');
      if (parts.length >= 2) {
        benefits.push(parts[1]);
      }
    }
  });
  
  return { features, benefits };
};

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è —Å–µ–∫—Ü–∏–∏ –º–∞—Ä–∞—Ñ–æ–Ω–æ–≤
export const generateMarathonFeatures = (isBasic: boolean, courseDescription?: string) => {
  const parsed = courseDescription ? parseCourseDescription(courseDescription) : null;
  
  if (isBasic) {
    return parsed?.features?.slice(0, 5) || [
      '33 —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —Å HD-–≤–∏–¥–µ–æ',
      '–õ–∏–º—Ñ–æ–¥—Ä–µ–Ω–∞–∂–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –¥–ª—è —Å–Ω—è—Ç–∏—è –æ—Ç–µ–∫–æ–≤',
      '–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –æ—Å–∞–Ω–∫–∏ –∏ –æ–º–æ–ª–æ–∂–µ–Ω–∏–µ —à–µ–∏',
      '–§–æ—Ç–æ–¥–Ω–µ–≤–Ω–∏–∫ —Å –ò–ò –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞',
      '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ 24/7'
    ];
  } else {
    return [
      '–í—Å–µ —Ç–µ—Ö–Ω–∏–∫–∏ –±–∞–∑–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è',
      '–í–∞–∫—É—É–º–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –¥–ª—è –≤—ã—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–ª–ª–∞–≥–µ–Ω–∞',
      '–õ–∏—Ñ—Ç–∏–Ω–≥-–º–∞—Å—Å–∞–∂–∏ PRO —É—Ä–æ–≤–Ω—è',
      '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —ç–∫—Å–ø–µ—Ä—Ç–∞',
      '–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è',
      'VIP –≥—Ä—É–ø–ø–∞ –≤ Telegram —Å –∞–≤—Ç–æ—Ä–æ–º'
    ];
  }
};

// –ü—Ä–∞–≤–∏–ª–æ 8: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ª–µ–Ω–¥–∏–Ω–≥–∞
export const generateUniqueSlug = (marathonTitle: string, stage?: number) => {
  const clean = marathonTitle
    .toLowerCase()
    .replace(/[^–∞-—èa-z0-9]+/g, '-')
    .replace(/^-+|-+$/g, '');
  
  const stageStr = stage ? `-stage-${stage}` : '';
  const timestamp = Date.now().toString().slice(-4);
  
  return `${clean}${stageStr}-${timestamp}`;
};
