# –ß–µ–∫–ª–∏—Å—Ç –¥–µ–ø–ª–æ—è —Å–∏—Å—Ç–µ–º—ã –∏–º–ø–æ—Ä—Ç–∞

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ

1. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω API endpoint `/api/admin/data-import`
3. ‚úÖ –°–æ–∑–¥–∞–Ω UI –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ —Å drag-and-drop
4. ‚úÖ –ù–∞–ø–∏—Å–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è DATA_IMPORT_SYSTEM.md
5. ‚úÖ –°–æ–∑–¥–∞–Ω –∫–æ–º–º–∏—Ç a49b6ac –∏ –∑–∞–ø—É—à–µ–Ω –Ω–∞ GitHub
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏—è TypeScript

## üöÄ –¢—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

### 1. –ö–†–ò–¢–ò–ß–ù–û: –ú–∏–≥—Ä–∞—Ü–∏—è —Ü–µ–Ω –≤ –∫–æ–ø–µ–π–∫–∏

**–ù–∞ production —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:**

```bash
ssh root@37.252.20.170
cd /var/www/rejuvena-backend

# –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –ë–î (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
mongodump --out=/root/mongo-backup-$(date +%Y%m%d-%H%M%S)

# –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏ —Ü–µ–Ω
npx ts-node src/scripts/migrate-prices-to-kopeks.ts

# –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏:
# ‚úÖ –ó–∞–∫–∞–∑ CRM-XXX: YYYY‚ÇΩ ‚Üí ZZZZZZ –∫–æ–ø–µ–µ–∫
# üì¶ Orders: N –æ–±–Ω–æ–≤–ª–µ–Ω–æ
# üí≥ Payments: M –æ–±–Ω–æ–≤–ª–µ–Ω–æ
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –∑–∞–∫–∞–∑—ã: price, subtotal, total, discount, shippingCost √ó 100
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –ø–ª–∞—Ç–µ–∂–∏: amount √ó 100
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —É–∂–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (total > 100000)

### 2. –î–µ–ø–ª–æ–π –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏

GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ push –≤ main.

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–ø–ª–æ–π:**
```bash
ssh root@37.252.20.170
cd /var/www/rejuvena-backend
git pull origin main
```

–ï—Å–ª–∏ –Ω–µ –æ–±–Ω–æ–≤–∏–ª–æ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é:
```bash
cd /var/www/rejuvena-backend
git pull origin main
npm install
npm run build
pm2 restart rejuvena-backend
```

–î–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:
```bash
cd /var/www/rejuvena-backend/admin-panel
npm install
npm run build
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

**3.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://api.seplitza.ru/admin/shop-orders
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ü–µ–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 4500‚ÇΩ, –∞ –Ω–µ 450000‚ÇΩ)

**3.2 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://api.seplitza.ru/admin/data-import
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª –∏–∑ `/test-data/sample-orders.csv`
3. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–ª–∏—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
5. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º "insert" (—Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ)
6. –ù–∞–∂–º–∏—Ç–µ "–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"
7. –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**3.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î:**
```bash
mongosh
use rejuvena

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–Ω—ã –≤ –∫–æ–ø–µ–π–∫–∞—Ö
db.orders.findOne({ orderNumber: /CRM-/ })
# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ price –∏ total –±–æ–ª—å—à–∏–µ —á–∏—Å–ª–∞ (–≤ –∫–æ–ø–µ–π–∫–∞—Ö)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–ª–∞—Ç–µ–∂–∏
db.payments.findOne()
# amount –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –∫–æ–ø–µ–π–∫–∞—Ö
```

## üìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–∏—Å—Ç–µ–º—ã –∏–º–ø–æ—Ä—Ç–∞

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è –Ω–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ **"–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö"**:

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ CSV –∏ JSON —Ñ–∞–π–ª–æ–≤ (drag-and-drop)
- ‚úÖ –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ (—Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ `;`, `,`, `\t`)
- ‚úÖ –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö (orders/payments/users)
- ‚úÖ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä–≤—ã—Ö 10 –∑–∞–ø–∏—Å–µ–π
- ‚úÖ 3 —Ä–µ–∂–∏–º–∞ –∏–º–ø–æ—Ä—Ç–∞:
  - **insert** - —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏
  - **upsert** - –æ–±–Ω–æ–≤–∏—Ç—å + –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
  - **replace** - —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –∏ –∑–∞–º–µ–Ω–∏—Ç—å (–æ–ø–∞—Å–Ω–æ!)
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –æ–± –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –∏–º–ø–æ—Ä—Ç–æ–≤

### –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π:
–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ä—É—Å—Å–∫–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏:
- "–§–ò–û" ‚Üí fullName
- "Email" ‚Üí email
- "–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞" ‚Üí totalAmount
- –∏ —Ç.–¥.

–°–º. –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤ DATA_IMPORT_SYSTEM.md

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–¶–µ–Ω—ã –≤ CSV**: –ú–æ–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –∫–∞–∫ "1500‚ÇΩ", —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ –∫–æ–ø–µ–π–∫–∏ (150000)
2. **UPSERT —Ä–µ–∂–∏–º**: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö
3. **–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏**: –ü–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π –≤—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π—Ç–µ backup –ë–î
4. **–ò—Å—Ç–æ—Ä–∏—è –∏–º–ø–æ—Ä—Ç–∞**: –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ "–ò—Å—Ç–æ—Ä–∏—è"

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ï—Å–ª–∏ —Ü–µ–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
mongosh
use rejuvena
db.orders.findOne({ orderNumber: "CRM-529" })
# total –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ~450000, –∞ –Ω–µ ~4500
```

### –ï—Å–ª–∏ –∏–º–ø–æ—Ä—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
pm2 logs rejuvena-backend --lines 50

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä–æ—É—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã
grep -n "data-import" /var/www/rejuvena-backend/src/server.ts
```

### –ï—Å–ª–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –Ω–µ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å:
```bash
cd /var/www/rejuvena-backend/admin-panel
npm run build
# –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞: Ctrl+Shift+R
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `DATA_IMPORT_SYSTEM.md`
- –ü—Ä–∏–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤: `test-data/sample-orders.csv`, `test-data/sample-payments.json`
- –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏: `src/scripts/migrate-prices-to-kopeks.ts`

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

---

**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é ‚úÖ
**–ö–æ–º–º–∏—Ç:** a49b6ac
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** $(date +%Y-%m-%d)
